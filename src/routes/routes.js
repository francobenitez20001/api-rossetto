const router = require("express").Router();

const db = require("../database/database");

const password = "ZAQ12wsx";

router.get("/", (req, res) => {
  res.send("Servidor funcionando con exito");
});

router.get("/quienes_somos", (req, res) => {
  db.query(
    "SELECT contenido FROM recursos WHERE id = 1",
    (err, rows, fields) => {
      if (!err) {
        res.send({
          status: true,
          data: rows,
          info: "Se ejecuto con exito la peticion",
        });
      } else {
        res.send({
          status: false,
          info: err,
        });
      }
    }
  );
});

router.put("/quienes_somos_modificar", (req, res) => {
  const { contenido, pass } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE recursos SET contenido = ? WHERE id = 1",
      [contenido],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "Se ejecuto con exito la peticion",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "La contraseÃ±a ingresada no es compatible.",
    });
  }
});
// FILTERS ------------------------------------

router.get("/filtrar_operacion/:idOperacion/:order", (req, res) => {
  let { idOperacion, order } = req.params;
  if (order == "normal") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idOperacion = ?",
      [idOperacion],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "low") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idOperacion = ? ORDER BY precio ASC",
      [idOperacion],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "high") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idOperacion = ? ORDER BY precio DESC",
      [idOperacion],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  }
});

router.get("/filtrar_categoria/:idCategoria/:order", (req, res) => {
  const { idCategoria, order } = req.params;
  if (order == "normal") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idCategoria = ?",
      [idCategoria],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "high") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idCategoria = ? ORDER BY precio DESC",
      [idCategoria],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "low") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idCategoria = ? ORDER BY precio ASC",
      [idCategoria],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  }
});

router.get("/filtrar_ubicacion/:idLocalidad/:order", (req, res) => {
  const { idLocalidad, order } = req.params;
  if (order == "normal") {
    db.query(
      "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idLocalidad = ?",
      [idLocalidad],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "high") {
    db.query(
      "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idLocalidad = ? ORDER BY precio DESC",
      [idLocalidad],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "low") {
    db.query(
      "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idLocalidad = ? ORDER BY precio ASC",
      [idLocalidad],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  }
});

router.get(
  "/filtrar_todo/:idLocalidad/:idCategoria/:idOperacion/:order/:moneda",
  (req, res) => {
    const { idLocalidad, idCategoria, idOperacion, order, moneda } = req.params;
    if (order == "normal") {
      db.query(
        "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idLocalidad = ? AND idCategoria = ? AND idOperacion = ? AND moneda = ?",
        [idLocalidad, idCategoria, idOperacion, moneda],
        (err, rows, fields) => {
          if (!err) {
            casas = [];
            rows.forEach((inmueble) => {
              casas.push(inmueble.id);
            });
            db.query(
              "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
              [casas],
              (error, imagen, celdas) => {
                if (!error) {
                  rows.forEach((propiedad) => {
                    imagen.forEach((header) => {
                      if (propiedad.id == header.idCasa) {
                        propiedad.header = header.nombre;
                      }
                    });
                  });

                  res.send({
                    status: true,
                    data: rows,
                    info: "se muestran todas los inmuebles que hay en la DB",
                  });
                } else {
                  res.send({
                    status: false,
                    info: error,
                  });
                }
              }
            );
          } else {
            res.send({
              status: false,
              info: err,
            });
          }
        }
      );
    } else if (order == "high") {
      db.query(
        "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idLocalidad = ? AND idCategoria = ? AND idOperacion = ? AND moneda = ? ORDER BY precio DESC",
        [idLocalidad, idCategoria, idOperacion, moneda],
        (err, rows, fields) => {
          if (!err) {
            casas = [];
            rows.forEach((inmueble) => {
              casas.push(inmueble.id);
            });
            db.query(
              "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
              [casas],
              (error, imagen, celdas) => {
                if (!error) {
                  rows.forEach((propiedad) => {
                    imagen.forEach((header) => {
                      if (propiedad.id == header.idCasa) {
                        propiedad.header = header.nombre;
                      }
                    });
                  });

                  res.send({
                    status: true,
                    data: rows,
                    info: "se muestran todas los inmuebles que hay en la DB",
                  });
                } else {
                  res.send({
                    status: false,
                    info: error,
                  });
                }
              }
            );
          } else {
            res.send({
              status: false,
              info: err,
            });
          }
        }
      );
    } else if (order == "low") {
      db.query(
        "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idLocalidad = ? AND idCategoria = ? AND idOperacion = ? AND moneda = ? ORDER BY precio ASC",
        [idLocalidad, idCategoria, idOperacion, moneda],
        (err, rows, fields) => {
          if (!err) {
            casas = [];
            rows.forEach((inmueble) => {
              casas.push(inmueble.id);
            });
            db.query(
              "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
              [casas],
              (error, imagen, celdas) => {
                if (!error) {
                  rows.forEach((propiedad) => {
                    imagen.forEach((header) => {
                      if (propiedad.id == header.idCasa) {
                        propiedad.header = header.nombre;
                      }
                    });
                  });

                  res.send({
                    status: true,
                    data: rows,
                    info: "se muestran todas los inmuebles que hay en la DB",
                  });
                } else {
                  res.send({
                    status: false,
                    info: error,
                  });
                }
              }
            );
          } else {
            res.send({
              status: false,
              info: err,
            });
          }
        }
      );
    }
  }
);

router.get(
  "/filtrar_categoria_operacion/:idCategoria/:idOperacion/:order/:moneda",
  (req, res) => {
    const { idCategoria, idOperacion, order, moneda } = req.params;
    if (order == "normal") {
      db.query(
        "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idCategoria = ? AND idOperacion = ? AND moneda = ?",
        [idCategoria, idOperacion, moneda],
        (err, rows, fields) => {
          if (!err) {
            casas = [];
            rows.forEach((inmueble) => {
              casas.push(inmueble.id);
            });
            db.query(
              "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
              [casas],
              (error, imagen, celdas) => {
                if (!error) {
                  rows.forEach((propiedad) => {
                    imagen.forEach((header) => {
                      if (propiedad.id == header.idCasa) {
                        propiedad.header = header.nombre;
                      }
                    });
                  });

                  res.send({
                    status: true,
                    data: rows,
                    info: "se muestran todas los inmuebles que hay en la DB",
                  });
                } else {
                  res.send({
                    status: false,
                    info: error,
                  });
                }
              }
            );
          } else {
            res.send({
              status: false,
              info: err,
            });
          }
        }
      );
    } else if (order == "low") {
      db.query(
        "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idCategoria = ? AND idOperacion = ? AND moneda = ? ORDER BY precio ASC",
        [idCategoria, idOperacion, moneda],
        (err, rows, fields) => {
          if (!err) {
            casas = [];
            rows.forEach((inmueble) => {
              casas.push(inmueble.id);
            });
            db.query(
              "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
              [casas],
              (error, imagen, celdas) => {
                if (!error) {
                  rows.forEach((propiedad) => {
                    imagen.forEach((header) => {
                      if (propiedad.id == header.idCasa) {
                        propiedad.header = header.nombre;
                      }
                    });
                  });

                  res.send({
                    status: true,
                    data: rows,
                    info: "se muestran todas los inmuebles que hay en la DB",
                  });
                } else {
                  res.send({
                    status: false,
                    info: error,
                  });
                }
              }
            );
          } else {
            res.send({
              status: false,
              info: err,
            });
          }
        }
      );
    } else if (order == "high") {
      db.query(
        "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id WHERE idCategoria = ? AND idOperacion = ? AND moneda = ? ORDER BY precio DESC",
        [idCategoria, idOperacion, moneda],
        (err, rows, fields) => {
          if (!err) {
            casas = [];
            rows.forEach((inmueble) => {
              casas.push(inmueble.id);
            });
            db.query(
              "SELECT * FROM imagenes WHERE idCasa = ? AND header = true",
              [casas],
              (error, imagen, celdas) => {
                if (!error) {
                  rows.forEach((propiedad) => {
                    imagen.forEach((header) => {
                      if (propiedad.id == header.idCasa) {
                        propiedad.header = header.nombre;
                      }
                    });
                  });

                  res.send({
                    status: true,
                    data: rows,
                    info: "se muestran todas los inmuebles que hay en la DB",
                  });
                } else {
                  res.send({
                    status: false,
                    info: error,
                  });
                }
              }
            );
          } else {
            res.send({
              status: false,
              info: err,
            });
          }
        }
      );
    }
  }
);

// !FILTERS ------------------------------------

// IMAGES

router.post("/insertar_imagen", (req, res) => {
  const { idCasa, nombre, header, pass } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO imagenes(idCasa, nombre, header) VALUES (?, ?, ?)",
      [idCasa, nombre, header],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "imagen insertada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

router.put("/modificar_imagen", (req, res) => {
  const { id, nombre, header, idCasa, pass } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE imagenes SET idCasa =?, nombre =?, header =? WHERE id = ?",
      [idCasa, nombre, header, id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "Imagen modificada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

router.delete("/borrar_imagen/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query("DELETE FROM imagenes WHERE id=?", [id], (err, rows, fields) => {
      if (!err) {
        res.send({
          status: true,
          info: "se ha borrado con Ã©xito el registro",
        });
      } else {
        res.send({
          status: false,
          info: err,
        });
      }
    });
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

router.get("/imagenes", (req, res) => {
  db.query("SELECT * FROM imagenes", (err, rows, fields) => {
    if (!err) {
      res.send({
        status: true,
        data: rows,
        info: "se muestran todas las imagenes que hay en la DB",
      });
    } else {
      res.send({
        status: false,
        info: err,
      });
    }
  });
});

// IMAGES

//SERVICES

router.post("/insertar_servicio", (req, res) => {
  const {
    idCasa,
    luz,
    agua,
    calefaccion,
    telefono,
    gas,
    internet,
    pass,
  } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO servicios(idCasa, luz, agua, calefaccion, telefono, gas, internet) VALUES (?, ?, ?, ?, ?, ?, ?)",
      [idCasa, luz, agua, calefaccion, telefono, gas, internet],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "servicio insertado con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

router.put("/modificar_servicio", (req, res) => {
  const {
    id,
    idCasa,
    luz,
    agua,
    calefaccion,
    telefono,
    gas,
    internet,
    pass,
  } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE servicios SET idCasa =?, luz =?, agua =?, calefaccion =?, telefono=?, gas=?, internet=? WHERE id = ?",
      [idCasa, luz, agua, calefaccion, telefono, gas, internet, id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "Servicio modificado con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

router.delete("/borrar_servcio/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query("DELETE FROM servicios WHERE id=?", [id], (err, rows, fields) => {
      if (!err) {
        res.send({
          status: true,
          info: "se ha borrado con Ã©xito el registro",
        });
      } else {
        res.send({
          status: false,
          info: err,
        });
      }
    });
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

router.get("/servicios", (req, res) => {
  db.query("SELECT * FROM servicios", (err, rows, fields) => {
    if (!err) {
      res.send({
        status: true,
        data: rows,
        info: "se muestran todos los servicios que hay en la DB",
      });
    } else {
      res.send({
        status: false,
        info: err,
      });
    }
  });
});

//SERVICES

// INICIO FUNCIÃN ----- MODIFICAR DATO TECNICO -----

router.put("/modificar_dato_tecnico", (req, res) => {
  const {
    id,
    pass,
    idCasa,
    dormitorios,
    s_terreno,
    s_cubierta,
    s_semicubierta,
    cochera,
    pileta,
  } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE datos_tecnicos SET idCasa =?, dormitorios =?, s_terreno =?, s_cubierta =?, s_semicubierta =?, cochera =?, pileta =? WHERE id = ?",
      [
        idCasa,
        dormitorios,
        s_terreno,
        s_cubierta,
        s_semicubierta,
        cochera,
        pileta,
        id,
      ],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "Dato tecnico modificado con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- MODIFICAR DATO TECNICO -----

// INICIO FUNCIÃN ----- BORRAR DATO TECNICO -----

router.delete("/borrar_dato_tecnico/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query(
      "DELETE FROM datos_tecnicos WHERE id=?",
      [id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "se ha borrado con Ã©xito el registro",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- BORRAR DATO TECNICO -----

// INICIO FUNCIÃN ----- MOSTRAR DATOS TECNICOS -----

router.get("/datos_tecnicos", (req, res) => {
  db.query("SELECT * FROM datos_tecnicos", (err, rows, fields) => {
    if (!err) {
      res.send({
        status: true,
        data: rows,
        info: "se muestran todos los datos tecnicos que hay en la DB",
      });
    } else {
      res.send({
        status: false,
        info: err,
      });
    }
  });
});

// FINAL FUNCIÃN ----- MOSTRAR DATOS TECNICOS -----

// INICIO FUNCIÃN ----- INSERTAR DATOS TECNICOS -----

router.post("/insertar_dato_tecnico", (req, res) => {
  const {
    pass,
    idCasa,
    dormitorios,
    s_terreno,
    s_cubierta,
    s_semicubierta,
    cochera,
    pileta,
  } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO datos_tecnicos(idCasa, dormitorios, s_terreno, s_cubierta, s_semicubierta, cochera, pileta) VALUES (?, ?, ?, ?, ?, ?, ?)",
      [
        idCasa,
        dormitorios,
        s_terreno,
        s_cubierta,
        s_semicubierta,
        cochera,
        pileta,
      ],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "operacion insertada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- INSERTAR DATOS TECNICOS -----

// INICIO FUNCIÃN ----- INSERTAR INMUEBLES -----

router.post("/insertar_inmueble", (req, res) => {
  const {
    idOperacion,
    precio,
    idLocalidad,
    direccion,
    idCategoria,
    descripcion,
    estado,
    moneda,
    pass,
  } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO inmuebles(idOperacion, precio, idLocalidad, direccion, idCategoria, descripcion, estado, moneda) VALUES (? , ?, ?, ? , ?, ?, ?, ?)",
      [
        idOperacion,
        precio,
        idLocalidad,
        direccion,
        idCategoria,
        descripcion,
        estado,
        moneda,
      ],
      (err, rows, fields) => {
        if (!err) {
          db.query(
            "SELECT id FROM inmuebles ORDER BY id DESC LIMIT 1",
            [
              idOperacion,
              precio,
              idLocalidad,
              direccion,
              idCategoria,
              descripcion,
              estado,
              moneda,
            ],
            (error, filas, celdas) => {
              if (!error) {
                res.send({
                  status: true,
                  data: filas,
                  info: "operacion insertada con Ã©xito",
                });
              } else {
                res.send({
                  status: false,
                  info: err,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- INSERTAR INMUEBLES -----

// INICIO FUNCIÃN ----- MOSTRAR INMUEBLES -----

router.get("/listar_inmuebles/:cantidad/:order", (req, res) => {
  const cantidad = parseInt(req.params.cantidad);
  const order = req.params.order;
  if (order == "normal") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id ORDER BY inmuebles.id DESC LIMIT ?",
      [cantidad],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa IN (?) AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "high") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id ORDER BY inmuebles.precio DESC LIMIT ?",
      [cantidad],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa IN (?) AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else if (order == "low") {
    db.query(
      "SELECT  ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id ORDER BY inmuebles.precio ASC LIMIT ?",
      [cantidad],
      (err, rows, fields) => {
        if (!err) {
          casas = [];
          rows.forEach((inmueble) => {
            casas.push(inmueble.id);
          });
          db.query(
            "SELECT * FROM imagenes WHERE idCasa IN (?) AND header = true",
            [casas],
            (error, imagen, celdas) => {
              if (!error) {
                rows.forEach((propiedad) => {
                  imagen.forEach((header) => {
                    if (propiedad.id == header.idCasa) {
                      propiedad.header = header.nombre;
                    }
                  });
                });

                res.send({
                  status: true,
                  data: rows,
                  info: "se muestran todas los inmuebles que hay en la DB",
                });
              } else {
                res.send({
                  status: false,
                  info: error,
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  }
});

// FINAL FUNCIÃN ----- MOSTRAR INMUEBLES -----

// INICIO FUNCIÃN ----- DETALLAR INMUEBLE X ID-----

router.get("/detallar_inmueble_id/:id", (req, res) => {
  const id = req.params.id;
  if (id != undefined) {
    db.query(
      "SELECT ubicacion.partido, ubicacion.localidad, tipo_operacion.operacion, categorias.categoria,servicios.*, datos_tecnicos.*, inmuebles.* FROM inmuebles LEFT JOIN ubicacion ON inmuebles.idLocalidad = ubicacion.id LEFT JOIN categorias ON inmuebles.idCategoria = categorias.id LEFT JOIN tipo_operacion ON inmuebles.idOperacion = tipo_operacion.id LEFT JOIN servicios ON inmuebles.id = servicios.idCasa LEFT JOIN datos_tecnicos ON inmuebles.id = datos_tecnicos.idCasa WHERE inmuebles.id = ?;",
      [id],
      (err, rows, fields) => {
        if (!err) {
          db.query(
            "SELECT * FROM imagenes WHERE idCasa = ?",
            [id],
            (error, images, celdas) => {
              if (!error) {
                res.send({
                  status: true,
                  data: rows,
                  imagenes: images,
                  info: "Se muestran todos los detalles de la casa con ese id",
                });
              } else {
                res.send({
                  status: false,
                  info: "Problemas en el segundo Query (Imagenes)",
                });
              }
            }
          );
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "No has ingresado ningun id para buscar",
    });
  }
});

// FINAL FUNCIÃN ----- DETALLAR INMUEBLE X ID -----

// INICIO FUNCIÃN ----- MODIFICAR INMUEBLE -----

router.put("/modificar_inmueble", (req, res) => {
  const {
    id,
    pass,
    idOperacion,
    precio,
    idLocalidad,
    direccion,
    idCategoria,
    descripcion,
    estado,
    moneda,
  } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE inmuebles SET idOperacion = ?, precio = ?, idLocalidad = ?, direccion = ?, idCategoria = ?, descripcion = ?, estado = ?, moneda = ? WHERE id = ?",
      [
        idOperacion,
        precio,
        idLocalidad,
        direccion,
        idCategoria,
        descripcion,
        estado,
        moneda,
        id,
      ],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "inmueble modificado con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- MODIFICAR INMUEBLE -----

// INICIO FUNCIÃN ----- BORRAR INMUEBLE -----

router.delete("/borrar_inmueble/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query(
      "DELETE FROM datos_tecnicos WHERE idCasa = ?;DELETE FROM servicios WHERE idCasa = ?;DELETE FROM imagenes WHERE idCasa = ?;DELETE FROM inmuebles WHERE id = ?;",
      [id, id, id, id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "se ha borrado con Ã©xito el registro",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- BORRAR INMUEBLE -----

// INICIO FUNCIÃN ----- BORRAR UBICACIÃN -----

router.delete("/borrar_ubicacion/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query("DELETE FROM ubicacion WHERE id=?", [id], (err, rows, fields) => {
      if (!err) {
        res.send({
          status: true,
          info: "se ha borrado con Ã©xito el registro",
        });
      } else {
        res.send({
          status: false,
          info: err,
        });
      }
    });
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- BORRAR UBICACIÃN -----

// INICIO FUNCIÃN ----- MOSTRAR UBICACIÃN -----

router.get("/ubicaciones", (req, res) => {
  db.query("SELECT * FROM ubicacion", (err, rows, fields) => {
    if (!err) {
      res.send({
        status: true,
        data: rows,
        info: "se muestran todas las ubicaciones que hay en la DB",
      });
    } else {
      res.send({
        status: false,
        info: err,
      });
    }
  });
});

// FINAL FUNCIÃN ----- MOSTRAR UBICACIÃN -----

// INICIO FUNCIÃN ----- BUSCAR LOCALIDADES -----

router.get("/buscar_localidades/:partido", (req, res) => {
  const partido = req.params.partido;
  if (partido != undefined) {
    db.query(
      "SELECT * FROM ubicacion WHERE partido LIKE ? ",
      [partido],
      (err, rows, fields) => {
        if (!err) {
          console.log(rows);
          res.send({
            status: true,
            data: rows,
            info:
              "se muestran todas las categorias con ese id que hay en la DB",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "No has ingresado ningun id para buscar",
    });
  }
});

// FINAL FUNCIÃN ----- BUSCAR LOCALIDADES -----

// INICIO FUNCIÃN ----- BUSCAR UBICACION -----

router.get("/buscar_ubicacion/:id", (req, res) => {
  const id = req.params.id;
  if (id != undefined) {
    db.query(
      "SELECT * FROM ubicacion WHERE id LIKE ? ",
      [id],
      (err, rows, fields) => {
        if (!err) {
          console.log(rows);
          res.send({
            status: true,
            data: rows,
            info:
              "se muestran todas las categorias con ese id que hay en la DB",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "No has ingresado ningun id para buscar",
    });
  }
});

// FINAL FUNCIÃN ----- BUSCAR UBICACION -----

// INICIO FUNCIÃN ----- INSERTAR UBICACIÃN -----

router.post("/insertar_ubicacion", (req, res) => {
  const { partido, localidad, pass } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO ubicacion(partido, localidad) VALUES (? , ?)",
      [partido, localidad],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "operacion insertada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- INSERTAR UBICACIÃN -----

// INICIO FUNCIÃN ----- MODIFICAR UBICACIÃN -----

router.put("/modificar_ubicacion", (req, res) => {
  const { id, partido, localidad, pass } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE ubicacion SET partido = ? , localidad = ? WHERE id = ?",
      [partido, localidad, id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "ubicacion modificada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- MODIFICAR UBICACIÃN -----

// INICIO FUNCIÃN ----- BORRAR TIPO DE OPERACIÃN -----

router.delete("/borrar_operacion/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query(
      "DELETE FROM tipo_operacion WHERE id=?",
      [id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "se ha borrado con Ã©xito el registro",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- BORRAR TIPO DE OPERACIÃN -----

// INICIO FUNCIÃN ----- MOSTRAR TIPO DE OPERACIÃN -----

router.get("/operaciones", (req, res) => {
  db.query("SELECT * FROM tipo_operacion", (err, rows, fields) => {
    if (!err) {
      res.send({
        status: true,
        data: rows,
        info: "se muestran todas las operaciones que hay en la DB",
      });
    } else {
      res.send({
        status: false,
        info: err,
      });
    }
  });
});

// FINAL FUNCIÃN ----- MOSTRAR TIPO DE OPERACIÃN -----

// INICIO FUNCIÃN ----- MOSTRAR TIPO DE OPERACIÃN -----

router.get("/buscar_operacion/:id", (req, res) => {
  const id = req.params.id;
  db.query(
    "SELECT * FROM tipo_operacion WHERE id = ?",
    [id],
    (err, rows, fields) => {
      if (!err) {
        res.send({
          status: true,
          data: rows,
          info: "se muestran todas las operaciones que hay en la DB",
        });
      } else {
        res.send({
          status: false,
          info: err,
        });
      }
    }
  );
});

// FINAL FUNCIÃN ----- MOSTRAR TIPO DE OPERACIÃN -----

// INICIO FUNCIÃN ----- INSERTAR TIPO DE OPERACIÃN -----

router.post("/insertar_operacion", (req, res) => {
  const { operacion, pass } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO tipo_operacion(operacion) VALUES (?)",
      [operacion],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "operacion insertada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- INSERTAR TIPO DE OPERACIÃN -----

// INICIO FUNCIÃN ----- MODIFICAR TIPO DE OPERACIÃN -----

router.put("/modificar_operacion", (req, res) => {
  const { id, operacion, pass } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE tipo_operacion SET operacion = ? WHERE id = ?",
      [operacion, id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "operacion modificada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- MODIFICAR TIPO DE OPERACIÃN -----

// INICIO FUNCIÃN ----- BORRAR CATEGORIA -----

router.delete("/borrar_categoria/:id/:pass", (req, res) => {
  const { id, pass } = req.params;
  if (pass == password) {
    db.query("DELETE FROM categorias WHERE id=?", [id], (err, rows, fields) => {
      if (!err) {
        res.send({
          status: true,
          info: "se ha borrado con Ã©xito el registro",
        });
      } else {
        res.send({
          status: false,
          info: err,
        });
      }
    });
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- BORRAR CATEGORIA -----

// INICIO FUNCIÃN ----- MOSTRAR CATEGORIAS -----

router.get("/categorias", (req, res) => {
  db.query("SELECT * FROM categorias", (err, rows, fields) => {
    if (!err) {
      res.send({
        status: true,
        data: rows,
        info: "se muestran todas las categorias que hay en la DB",
      });
    } else {
      res.send({
        status: false,
        info: err,
      });
    }
  });
});

// FINAL FUNCIÃN ----- MOSTRAR CATEGORIAS -----

// INICIO FUNCIÃN ----- BUSCAR CATEGORIA X ID -----

router.get("/buscar_categoria_id/:id", (req, res) => {
  const id = req.params.id;
  if (id != undefined) {
    db.query(
      "SELECT * FROM categorias WHERE id LIKE ? ",
      [id],
      (err, rows, fields) => {
        if (!err) {
          console.log(rows);
          res.send({
            status: true,
            data: rows,
            info:
              "se muestran todas las categorias con ese id que hay en la DB",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "No has ingresado ningun id para buscar",
    });
  }
});

// FINAL FUNCIÃN ----- BUSCAR CATEGORIA X ID -----

// INICIO FUNCIÃN ----- BUSCAR CATEGORIA X NOMBRE -----

router.get("/buscar_categoria_nombre/:categoria", (req, res) => {
  const categoria = req.params.categoria;
  if (categoria != undefined) {
    db.query(
      "SELECT * FROM categorias WHERE categoria LIKE ? ",
      [categoria],
      (err, rows, fields) => {
        if (!err) {
          console.log(rows);
          res.send({
            status: true,
            data: rows,
            info:
              "se muestran todas las categorias con ese nombre que hay en la DB",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "No has ingresado ningun nombre de categoria para buscar",
    });
  }
});

// FINAL FUNCIÃN ----- BUSCAR CATEGORIA X NOMBRE -----

// INICIO FUNCIÃN ----- INSERTAR CATEGORIA -----

router.post("/insertar_categoria", (req, res) => {
  const { categoria, pass } = req.body;
  if (pass == password) {
    db.query(
      "INSERT INTO categorias(categoria) VALUES (?)",
      [categoria],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "categoria insertada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- INSERTAR CATEGORIA -----

// INICIO FUNCIÃN ----- MODIFICAR CATEGORIA -----

router.put("/modificar_categoria", (req, res) => {
  const { id, categoria, pass } = req.body;
  if (pass == password) {
    db.query(
      "UPDATE categorias SET categoria = ? WHERE id = ?",
      [categoria, id],
      (err, rows, fields) => {
        if (!err) {
          res.send({
            status: true,
            info: "categoria modificada con Ã©xito",
          });
        } else {
          res.send({
            status: false,
            info: err,
          });
        }
      }
    );
  } else {
    res.send({
      status: false,
      info: "la contraseÃ±a ingresada no es compatible",
    });
  }
});

// FINAL FUNCIÃN ----- MODIFICAR CATEGORIA -----

module.exports = router;
